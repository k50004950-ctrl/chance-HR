# 회귀 테스트 체크리스트

**목적**: UI 리팩터링 후 모든 기능이 정상 동작하는지 검증

## 사전 준비

### 테스트 계정
```
SUPER_ADMIN:
- Username: admin
- Password: !Q1538215a

OWNER (사업주):
- Username: 테스터2
- Password: 1234

EMPLOYEE (직원):
- Username: 배유진
- Password: 1234
```

### 테스트 환경
- [ ] Local: http://localhost:5000
- [ ] Production: https://chance-hr-production.up.railway.app

---

## A. 인증/권한 테스트

### A1. 로그인 성공/실패
- [ ] **정상 로그인**: 유효한 계정으로 로그인 → 역할별 대시보드 진입
- [ ] **실패 - 잘못된 비밀번호**: 에러 메시지 표시
- [ ] **실패 - 존재하지 않는 계정**: 에러 메시지 표시
- [ ] **토큰 만료**: 만료된 토큰으로 API 호출 → 401 → 로그인 페이지 리다이렉트

### A2. 역할별 접근 제어
| 역할 | /admin | /owner | /employee | 기대 결과 |
|------|--------|--------|-----------|-----------|
| super_admin | ✅ | ❌ | ❌ | AdminDashboard 표시 |
| admin | ✅ | ❌ | ❌ | AdminDashboard 표시 |
| owner | ❌ | ✅ | ❌ | OwnerDashboard 표시 |
| employee | ❌ | ❌ | ✅ | EmployeeDashboard 표시 |

**테스트 방법**:
```javascript
// Browser Console
localStorage.setItem('token', '<다른_역할_토큰>');
location.href = '/admin'; // 403 또는 리다이렉트 확인
```

### A3. 로그아웃
- [ ] 로그아웃 버튼 클릭 → `/login`으로 리다이렉트
- [ ] localStorage에서 `token` 삭제 확인
- [ ] 뒤로가기 → ProtectedRoute에서 차단

---

## B. 사업주(OWNER) 핵심 플로우

### B1. 로그인 & 사업장 선택
**테스트 시나리오**:
1. 로그인 페이지에서 `테스터2 / 1234` 입력
2. "로그인" 버튼 클릭
3. OwnerDashboard 로드 대기

**검증 항목**:
- [ ] JWT 토큰이 localStorage에 저장됨
- [ ] 사업장 드롭다운에 "테스터사업장" 표시
- [ ] 사업장 자동 선택 (단일 사업장인 경우)
- [ ] 직원 목록 로드 완료 (Loading spinner → 데이터 표시)
- [ ] Network 탭: `GET /api/workplaces/my` 성공 (200)
- [ ] Network 탭: `GET /api/employees/workplace/:id` 성공 (200)

**실패 조건**:
- ❌ "권한이 없습니다" 메시지
- ❌ 무한 로딩 (spinner만 계속 표시)
- ❌ 콘솔 에러: `Cannot read property 'id' of null`

---

### B2. 직원 등록
**테스트 시나리오**:
1. "직원 관리" 탭 클릭
2. "직원 추가" 버튼 클릭
3. 모달에서 다음 입력:
   ```
   이름: 테스트직원A
   생년월일: 1990-01-01
   주민번호 뒷자리: 1234567
   전화번호: 010-1234-5678
   입사일: 2026-01-01
   급여유형: 월급
   급여액: 2500000
   근무요일: 월,화,수,목,금
   근무시작: 09:00
   근무종료: 18:00
   급여지급일: 매달 말일
   세금신고: 4대보험
   부양가족수: 1
   
   사용자명: test_employee_a
   비밀번호: test1234
   ```
4. "저장" 버튼 클릭

**검증 항목**:
- [ ] 필수 필드 누락 시: `* 표시는 필수 입력 항목입니다` 안내
- [ ] 필수 필드 누락 시: 해당 필드에 에러 메시지 (빨간색 테두리)
- [ ] 사용자명 중복 체크: "이미 사용 중인 사용자명입니다" 메시지
- [ ] 저장 성공: "저장되었습니다" 토스트 메시지 (3초 후 자동 사라짐)
- [ ] 모달 닫힘
- [ ] 직원 목록에 "테스트직원A" 추가됨
- [ ] Network 탭: `POST /api/employees` → 201 Created

**실패 조건**:
- ❌ 저장 버튼 클릭 후 아무 반응 없음
- ❌ 모달이 닫히지 않음
- ❌ 500 Internal Server Error
- ❌ 직원 목록 새로고침 안 됨

---

### B3. 출근 기록 조회 & 수정
**테스트 시나리오 1: 조회**
1. "오늘 출근" 탭 클릭
2. 오늘 날짜의 출근 기록 확인

**검증 항목**:
- [ ] 출근 기록 테이블/카드 표시
- [ ] 상태별 색상:
  - 🟢 정상 (초록색 배경/테두리)
  - 🟠 지각 (주황색 배경/테두리)
  - 🔴 미퇴근 (빨간색 배경/테두리)
- [ ] 미퇴근 인원 > 0: 상단에 `⚠ 오늘 미퇴근 직원이 N명 있습니다` Alert 표시
- [ ] 테이블 행 hover 시: 배경색 변경 (강조)
- [ ] 모바일: 테이블 → 카드형 리스트로 자동 전환

**테스트 시나리오 2: 수정**
1. 미퇴근 상태 기록 클릭
2. 수정 모달에서 퇴근 시간 입력: `18:30`
3. "저장" 클릭

**검증 항목**:
- [ ] PUT `/api/attendance/:id` → 200 OK
- [ ] 리스트 자동 새로고침
- [ ] 해당 기록 상태: 미퇴근 → 정상/지각으로 변경
- [ ] 상단 Alert 업데이트 (미퇴근 카운트 감소)

**실패 조건**:
- ❌ 퇴근 시간 < 출근 시간: "퇴근 시간이 출근 시간보다 빠를 수 없습니다" 에러
- ❌ 수정 후 화면 반영 안 됨

---

### B4. 급여 계산 (4단계 플로우)
**테스트 시나리오**:
1. "급여 보내기" 탭 클릭
2. **Step 1**: 이번 달 (2026-01) 선택 → "다음 단계" 클릭
3. **Step 2**: 
   - 급여 자동 계산 결과 확인
   - "배유진" 직원의 총 지급액을 수동으로 `2,300,000`으로 수정
   - "다음 단계" 클릭
4. **Step 3**: 
   - ⚠️ "확정 후에는 수정이 어렵습니다" 경고 모달 확인
   - "급여 확정하기" 클릭
5. **Step 4**: 
   - ✅ "이번 달 급여가 확정되었습니다" 배지 표시 확인

**검증 항목 (자동 계산)**:
- [ ] **시급 직원**:
  - 기본급 = 시급 × 실제 근무시간
  - 주휴수당 = 시급 × (주당 평균 근무시간 ÷ 5)
  - 총 지급액 = 기본급 + 주휴수당
- [ ] **4대보험 직원**:
  - 국민연금 = 기준소득월액 × 4.75% (본인 부담)
  - 건강보험 = 기준소득월액 × 3.595%
  - 장기요양 = 건강보험료 × 12.95%
  - 고용보험 = 기준소득월액 × 0.9%
  - 소득세 = 간이세액표 조회 (기준소득, 부양가족수)
  - 지방소득세 = 소득세 × 10%
  - 총 지급액 = 기본급 - (4대보험료 + 소득세 + 지방소득세)
- [ ] **3.3% 프리랜서**:
  - 원천징수 = 기본급 × 3.3%
  - 총 지급액 = 기본급 - 원천징수

**검증 항목 (UI)**:
- [ ] Step 1 → Step 2 전환: Progress bar 업데이트
- [ ] Step 2에서 급여 수정: input 필드 정상 작동
- [ ] Step 3 확정 모달: "취소" 버튼 → Step 2로 돌아감
- [ ] Step 4 확정 후: Step 1로 돌아갈 수 없음 (버튼 비활성화)
- [ ] Network 탭: `POST /api/salary/calculate` → 200 OK

**실패 조건**:
- ❌ 주휴수당 = 0 (시급 직원인데 계산 안 됨)
- ❌ 4대보험료 = 0 (2025/2026 요율 적용 안 됨)
- ❌ Step 전환 시 데이터 손실
- ❌ "다음 단계" 버튼 클릭 후 무반응

---

### B5. 급여명세서 생성 & 발송
**사전 조건**: B4 완료 (급여 확정)

**테스트 시나리오**:
1. "급여 보내기" 탭 → "급여명세서" 서브탭
2. 당월 급여대장 자동 표시 확인:
   - 직원별 기본급, 공제액, 총 지급액
   - 사업주 부담금 (국민연금, 건강보험, 고용보험, 장기요양)
3. "급여명세서 관리" 섹션:
   - "배유진" 직원 선택
   - "명세서 수정" 버튼 클릭
   - 공제항목 확인 및 수정 (필요시)
   - "저장" 클릭
4. "배포" 버튼 클릭
5. 경고 모달 확인:
   - ⚠️ "세무대리인 한번더 검토 必 요청"
   - ⚠️ "이 기능은 홈택스 신고기능이 포함되어있지 않습니다"
   - "확인" 클릭

**검증 항목**:
- [ ] 급여대장 테이블 표시 (월 선택 가능)
- [ ] 급여대장 데이터 = 급여명세서 합산 결과
- [ ] 명세서 저장: `POST /api/salary/slips` → 201 Created
- [ ] 배포 후: `published = true` 업데이트
- [ ] 배포 후: 직원 계정에서 명세서 조회 가능
- [ ] 급여대장 자동 새로고침 (명세서 수정 시)

**실패 조건**:
- ❌ 급여대장이 표시되지 않음
- ❌ 명세서 수정 후 급여대장에 반영 안 됨
- ❌ 배포 후에도 직원이 명세서 못 봄
- ❌ 사업주 부담금 = 0 (계산 오류)

---

### B6. 퇴사 처리
**테스트 시나리오**:
1. "직원 관리" 탭
2. "테스트직원A" 선택
3. "퇴사 처리" 버튼 클릭
4. 퇴사일 입력: `2026-01-27`
5. ⚠️ 경고 모달 확인:
   - "퇴사 처리 후에도 직원은 과거 기록을 조회할 수 있습니다"
   - "확인" 클릭

**검증 항목**:
- [ ] PUT `/api/employees/:id` → 200 OK
- [ ] `employment_status = 'resigned'` 업데이트
- [ ] `resignation_date = '2026-01-27'` 저장
- [ ] 직원 목록에서 "퇴사" 배지 표시
- [ ] 필터: "재직 중" 선택 시 목록에서 제외
- [ ] 필터: "퇴사자" 선택 시 목록에 표시
- [ ] **직원 계정 로그인 가능** (삭제 아님)
- [ ] 직원 계정: 과거 급여/출근 기록 조회 가능
- [ ] 직원 계정: 새 출근 체크 불가 (버튼 비활성화)

**테스트 시나리오 2: 퇴사 취소**
1. "테스트직원A" 선택
2. "퇴사 취소" 버튼 클릭
3. 확인

**검증 항목**:
- [ ] `employment_status = 'active'` 복구
- [ ] `resignation_date = null`
- [ ] 직원 계정: 출근 체크 다시 가능

**실패 조건**:
- ❌ 퇴사 처리 후에도 "재직 중" 상태 유지
- ❌ 직원 계정 로그인 불가 (삭제됨)
- ❌ 퇴사자가 출근 체크 가능

---

### B7. QR 출근 시스템
**테스트 시나리오**:
1. "출근 달력" 탭 또는 "설정" 탭
2. "QR 출근 관리" 섹션
3. "QR 코드 생성" 버튼 클릭
4. QR 코드 이미지 표시 확인
5. 인쇄용 메시지 입력: `이 QR 코드로 출퇴근 체크하세요`
6. "인쇄용 메시지 저장" 클릭
7. "QR 코드 다운로드" 또는 인쇄

**검증 항목**:
- [ ] QR 코드 이미지 생성 (Canvas/SVG)
- [ ] QR 코드 URL 형식: `/qr?token=xxx&workplace=yyy`
- [ ] 인쇄 메시지 저장: `PUT /api/workplaces/:id` → 200 OK
- [ ] QR 스캔 후 `/qr` 페이지 진입
- [ ] GPS 권한 요청
- [ ] GPS 허용 범위 내: 출근 체크 성공
- [ ] GPS 허용 범위 밖: "출근 가능 범위를 벗어났습니다" 에러

**실패 조건**:
- ❌ QR 코드 이미지 생성 실패
- ❌ QR 스캔 후 404 Not Found
- ❌ GPS 좌표와 무관하게 출근 가능 (보안 문제)

---

### B8. 로그아웃
**테스트 시나리오**:
1. 헤더 "로그아웃" 버튼 클릭
2. `/login` 페이지 진입 확인
3. 브라우저 뒤로가기 클릭

**검증 항목**:
- [ ] localStorage에서 `token` 삭제됨
- [ ] `AuthContext.user = null`
- [ ] `/login`으로 리다이렉트
- [ ] 뒤로가기 시: ProtectedRoute에서 차단 → 다시 `/login`
- [ ] 수동으로 `/owner` 접근 시: 401 → `/login` 리다이렉트

**실패 조건**:
- ❌ 로그아웃 후에도 대시보드 접근 가능
- ❌ token이 localStorage에 남아있음

---

## C. 직원(EMPLOYEE) 핵심 플로우

### C1. 출근 체크
**테스트 시나리오**:
1. 직원 계정(`배유진 / 1234`)으로 로그인
2. EmployeeDashboard 진입
3. "출근" 버튼 클릭
4. GPS 권한 허용
5. "출근 체크 완료" 메시지 확인

**검증 항목**:
- [ ] GPS 좌표 수집
- [ ] 사업장 좌표와 거리 계산
- [ ] 허용 범위 내: `POST /api/attendance/check-in` → 201 Created
- [ ] 출근 시간 기록
- [ ] "출근" 버튼 → "퇴근" 버튼으로 변경

**실패 조건**:
- ❌ GPS 비활성화 시: 무한 로딩
- ❌ 중복 출근 체크 가능 (같은 날 2번 출근)
- ❌ 퇴사자가 출근 체크 가능

### C2. 퇴근 체크
**테스트 시나리오**:
1. (C1 완료 후) "퇴근" 버튼 클릭
2. GPS 권한 허용
3. "퇴근 체크 완료" 메시지 확인

**검증 항목**:
- [ ] `POST /api/attendance/check-out` → 200 OK
- [ ] 퇴근 시간 기록
- [ ] 근무 시간 자동 계산
- [ ] "퇴근" 버튼 비활성화

### C3. 급여명세서 조회
**테스트 시나리오**:
1. "급여명세서" 탭 클릭
2. 이번 달 (2026-01) 선택
3. 명세서 상세 내역 확인

**검증 항목**:
- [ ] `GET /api/salary/slips/employee` → 200 OK
- [ ] `published = true`인 명세서만 표시
- [ ] 기본급, 공제액, 총 지급액 표시
- [ ] "다운로드" 버튼: PDF 또는 이미지 다운로드

**실패 조건**:
- ❌ 미발송 명세서가 보임 (`published = false`)
- ❌ 다른 직원의 명세서가 보임 (권한 오류)

---

## D. 관리자(SUPER_ADMIN) 핵심 플로우

### D1. 사업주 관리
**테스트 시나리오**:
1. admin 계정 로그인
2. AdminDashboard 진입
3. "사업주 관리" 탭 (기본)
4. 사업주 목록 확인

**검증 항목 (PC)**:
- [ ] 테이블 형식으로 사업주 목록 표시
- [ ] 필터: 이름/사업장명 검색
- [ ] "승인" / "거부" 버튼 (미승인 사업주)
- [ ] "비밀번호 초기화" 기능

**검증 항목 (Mobile)**:
- [ ] **테이블이 표시되어야 함** (display: table)
- [ ] 카드형 리스트로 자동 전환 (선택사항)
- [ ] 가로 스크롤 가능

**실패 조건**:
- ❌ 모바일: 사업주 목록 테이블 표시 안 됨 (display: none)

### D2. 보험 요율 관리
**테스트 시나리오**:
1. "보험 요율 관리" 탭 클릭
2. "새 요율 추가" 버튼 클릭
3. 다음 입력:
   ```
   연도: 2027
   국민연금: 4.75%
   건강보험: 3.595%
   장기요양: 12.95%
   고용보험: 0.9%
   ```
4. "저장" 클릭

**검증 항목**:
- [ ] `POST /api/insurance-rates` → 201 Created
- [ ] 요율 목록에 추가됨
- [ ] 수정/삭제 가능

### D3. 공지사항 발송
**테스트 시나리오**:
1. "공지사항" 탭 클릭
2. 제목: `시스템 점검 안내`
3. 내용: `2026-01-28 02:00-04:00 시스템 점검 예정`
4. "전체 발송" 클릭

**검증 항목**:
- [ ] `POST /api/announcements` → 201 Created
- [ ] 모든 사용자 로그인 시: 공지사항 팝업 표시
- [ ] "닫기" 버튼: 팝업 닫힘 + 다시 표시 안 됨

---

## E. 모바일 반응형 테스트

### E1. 화면 크기별 레이아웃
**테스트 방법**: Chrome DevTools → Responsive Mode

| 디바이스 | 너비 | 검증 항목 |
|----------|------|-----------|
| iPhone SE | 375px | 하단 탭바, 텍스트 줄바꿈 정상 |
| iPhone 12 Pro | 390px | 터치 영역 충분 (최소 44px) |
| iPad | 768px | PC 레이아웃 전환 |
| Desktop | 1280px | 모든 기능 정상 |

**검증 항목**:
- [ ] 768px 이하: 하단 탭바 표시 (홈/출근/직원/급여/더보기)
- [ ] 769px 이상: 상단 네비게이션 표시
- [ ] 텍스트 줄바꿈: `word-break: keep-all`, `overflow-wrap: break-word`
- [ ] Flex child: `min-width: 0` 적용 (텍스트 넘침 방지)
- [ ] 스크롤 컨테이너: 중복 overflow 제거 (단일 스크롤만)

### E2. 터치 인터랙션
**테스트 방법**: 실제 모바일 기기 또는 DevTools Touch Mode

**검증 항목**:
- [ ] 버튼 터치 영역: 최소 44px × 44px
- [ ] Tap highlight: `-webkit-tap-highlight-color: transparent`
- [ ] 드롭다운/모달: 모바일에서 전체화면 또는 하단 시트
- [ ] 입력 필드: 키보드 올라올 때 뷰포트 조정

---

## F. 성능 테스트

### F1. 페이지 로드 시간
**측정 방법**: Chrome DevTools → Performance → Reload

**기준**:
- [ ] First Contentful Paint (FCP) < 1.5s
- [ ] Largest Contentful Paint (LCP) < 2.5s
- [ ] Time to Interactive (TTI) < 3.5s

### F2. API 응답 시간
**측정 방법**: Network 탭

| 엔드포인트 | 목표 | 실측 |
|-----------|------|------|
| GET /employees | < 500ms | _____ms |
| GET /attendance | < 500ms | _____ms |
| POST /salary/calculate | < 1000ms | _____ms |
| POST /attendance/check-in | < 300ms | _____ms |

---

## G. 보안 테스트

### G1. 인증 우회 시도
**테스트 방법**:
```javascript
// Console
localStorage.removeItem('token');
fetch('/api/employees/workplace/1', {
  headers: { 'Authorization': 'Bearer invalid_token' }
})
.then(r => r.json())
.then(console.log); // 401 Unauthorized 기대
```

**검증 항목**:
- [ ] JWT 없음: 401 Unauthorized
- [ ] 유효하지 않은 JWT: 401 Unauthorized
- [ ] 만료된 JWT: 401 Unauthorized

### G2. 권한 상승 시도
**테스트 방법**:
```javascript
// 직원 계정으로 로그인 후
fetch('/api/employees/workplace/1', {
  headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
})
.then(r => r.json())
.then(console.log); // 403 Forbidden 기대
```

**검증 항목**:
- [ ] 직원 → 사업주 기능: 403 Forbidden
- [ ] 사업주 → 관리자 기능: 403 Forbidden

---

## H. 최종 체크리스트

### 변경 전 백업
- [ ] 데이터베이스 백업 (production)
- [ ] 현재 코드 Git commit & tag
- [ ] 환경 변수 스냅샷

### 배포 전 로컬 테스트
- [ ] A1~A3: 인증/권한 테스트 통과
- [ ] B1~B8: 사업주 플로우 통과
- [ ] C1~C3: 직원 플로우 통과
- [ ] D1~D3: 관리자 플로우 통과
- [ ] E1~E2: 모바일 반응형 통과

### 배포 후 Production 테스트
- [ ] Production URL 접근 가능
- [ ] A1: 로그인 정상
- [ ] B1: 사업장 선택 정상
- [ ] B2: 직원 등록 정상
- [ ] B3: 출근 기록 조회 정상
- [ ] B4: 급여 계산 정상
- [ ] C1: 직원 출근 체크 정상
- [ ] D1 (Mobile): 사업주 목록 표시 정상

### 롤백 조건
**다음 중 하나라도 실패 시 즉시 롤백**:
- ❌ 로그인 불가
- ❌ 역할별 대시보드 진입 불가
- ❌ 직원 등록/수정 실패
- ❌ 출근 체크 실패
- ❌ 급여 계산 오류 (금액 차이)
- ❌ 권한 체크 우회 가능 (보안 문제)

---

## 테스트 결과 기록

**테스트 일시**: ____________  
**테스트 환경**: [ ] Local [ ] Production  
**테스터**: ____________

### 통과 현황
- [ ] A. 인증/권한 테스트 (___/3)
- [ ] B. 사업주 플로우 (___/8)
- [ ] C. 직원 플로우 (___/3)
- [ ] D. 관리자 플로우 (___/3)
- [ ] E. 모바일 반응형 (___/2)
- [ ] F. 성능 테스트 (___/2)
- [ ] G. 보안 테스트 (___/2)

**총점**: ___/23

### 발견된 이슈
| # | 분류 | 심각도 | 설명 | 상태 |
|---|------|--------|------|------|
| 1 |      | Critical/High/Medium/Low |      | Open/Fixed |
| 2 |      |      |      |      |

### 배포 승인
- [ ] 모든 Critical 이슈 해결
- [ ] 모든 High 이슈 해결 또는 문서화
- [ ] 핵심 플로우 8개 모두 통과
- [ ] 성능/보안 테스트 통과

**승인자**: ____________  
**승인 일시**: ____________
