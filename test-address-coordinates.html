<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ì†Œ ì¢Œí‘œ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .result {
            margin: 20px 0;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 5px;
        }
        .error {
            background: #ffe6e6;
            color: #d00;
        }
        .success {
            background: #e6ffe6;
            color: #060;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
        pre {
            background: #fff;
            padding: 10px;
            border: 1px solid #ddd;
            overflow-x: auto;
        }
        .map-link {
            display: inline-block;
            margin: 5px 0;
            padding: 8px 15px;
            background: #4285f4;
            color: white;
            text-decoration: none;
            border-radius: 4px;
        }
        .map-link:hover {
            background: #357ae8;
        }
    </style>
</head>
<body>
    <h1>ğŸ—ºï¸ ì£¼ì†Œ ì¢Œí‘œ ì •í™•ë„ í…ŒìŠ¤íŠ¸</h1>
    
    <div>
        <h2>í…ŒìŠ¤íŠ¸í•  ì£¼ì†Œ</h2>
        <input type="text" id="addressInput" value="ì„œìš¸ ê´€ì•…êµ¬ ì‘¥ê³ ê°œë¡œ 75" style="width: 400px; padding: 8px;">
        <button onclick="testAddress()">í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
    </div>

    <div id="results"></div>

    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_KAKAO_KEY&libraries=services"></script>
    <script>
        // í™˜ê²½ë³€ìˆ˜ì—ì„œ Kakao API í‚¤ ê°€ì ¸ì˜¤ê¸° (í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì‚¬ìš©í•˜ëŠ” í‚¤)
        const KAKAO_KEY = 'f08c77bfb5eb0bcf42a30ed4982c94f2'; // VITE_KAKAO_MAPS_KEY
        
        // ìŠ¤í¬ë¦½íŠ¸ ë‹¤ì‹œ ë¡œë“œ (ì •í™•í•œ í‚¤ë¡œ)
        if (KAKAO_KEY && KAKAO_KEY !== 'YOUR_KAKAO_KEY') {
            const scripts = document.querySelectorAll('script[src*="dapi.kakao.com"]');
            scripts.forEach(script => script.remove());
            
            const newScript = document.createElement('script');
            newScript.src = `//dapi.kakao.com/v2/maps/sdk.js?appkey=${KAKAO_KEY}&libraries=services`;
            newScript.onload = () => {
                console.log('âœ… Kakao Maps API ë¡œë“œ ì™„ë£Œ');
            };
            document.head.appendChild(newScript);
        }

        async function testAddress() {
            const address = document.getElementById('addressInput').value;
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="result">í…ŒìŠ¤íŠ¸ ì¤‘...</div>';

            const results = [];

            // 1. Kakao Geocoder í…ŒìŠ¤íŠ¸
            try {
                results.push('<h2>1ï¸âƒ£ Kakao Geocoder API ê²°ê³¼</h2>');
                
                if (!window.kakao || !window.kakao.maps || !window.kakao.maps.services) {
                    throw new Error('Kakao Maps APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }

                const geocoder = new kakao.maps.services.Geocoder();
                
                const kakaoResult = await new Promise((resolve, reject) => {
                    geocoder.addressSearch(address, (result, status) => {
                        console.log('Kakao Geocoder ì‘ë‹µ:', { result, status });
                        if (status === kakao.maps.services.Status.OK && result && result.length > 0) {
                            resolve(result[0]);
                        } else {
                            reject(new Error('ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'));
                        }
                    });
                });

                const lat = parseFloat(kakaoResult.y);
                const lng = parseFloat(kakaoResult.x);

                results.push(`
                    <div class="result success">
                        <strong>âœ… ì„±ê³µ</strong><br>
                        <strong>ì£¼ì†Œ:</strong> ${kakaoResult.address_name || kakaoResult.road_address?.address_name}<br>
                        <strong>ìœ„ë„ (Latitude):</strong> ${lat}<br>
                        <strong>ê²½ë„ (Longitude):</strong> ${lng}<br>
                        <strong>ì£¼ì†Œ íƒ€ì…:</strong> ${kakaoResult.address_type}<br>
                        <a class="map-link" href="https://www.google.com/maps?q=${lat},${lng}" target="_blank">
                            ğŸ—ºï¸ Google Mapsì—ì„œ í™•ì¸
                        </a>
                        <a class="map-link" href="https://map.kakao.com/link/map/${lat},${lng}" target="_blank">
                            ğŸ—ºï¸ Kakao Mapì—ì„œ í™•ì¸
                        </a>
                        <pre>${JSON.stringify(kakaoResult, null, 2)}</pre>
                    </div>
                `);
            } catch (error) {
                results.push(`
                    <div class="result error">
                        <strong>âŒ Kakao Geocoder ì˜¤ë¥˜</strong><br>
                        ${error.message}
                    </div>
                `);
            }

            // 2. Nominatim (OpenStreetMap) í…ŒìŠ¤íŠ¸
            try {
                results.push('<h2>2ï¸âƒ£ Nominatim (OpenStreetMap) API ê²°ê³¼</h2>');
                
                const simplifiedAddress = address.split(' ').slice(0, 3).join(' ');
                const encodedAddress = encodeURIComponent(simplifiedAddress);
                
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/search?format=json&q=${encodedAddress}&countrycodes=kr&limit=1`,
                    {
                        headers: {
                            'Accept': 'application/json',
                            'User-Agent': 'AttendanceSystem/1.0'
                        }
                    }
                );

                const data = await response.json();
                
                if (data && data.length > 0) {
                    const lat = parseFloat(data[0].lat);
                    const lon = parseFloat(data[0].lon);
                    
                    results.push(`
                        <div class="result success">
                            <strong>âœ… ì„±ê³µ</strong><br>
                            <strong>ê²€ìƒ‰ ì£¼ì†Œ:</strong> ${simplifiedAddress}<br>
                            <strong>ìœ„ë„ (Latitude):</strong> ${lat}<br>
                            <strong>ê²½ë„ (Longitude):</strong> ${lon}<br>
                            <strong>Display Name:</strong> ${data[0].display_name}<br>
                            <a class="map-link" href="https://www.google.com/maps?q=${lat},${lon}" target="_blank">
                                ğŸ—ºï¸ Google Mapsì—ì„œ í™•ì¸
                            </a>
                            <pre>${JSON.stringify(data[0], null, 2)}</pre>
                        </div>
                    `);
                } else {
                    results.push(`
                        <div class="result error">
                            <strong>âŒ ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</strong>
                        </div>
                    `);
                }
            } catch (error) {
                results.push(`
                    <div class="result error">
                        <strong>âŒ Nominatim ì˜¤ë¥˜</strong><br>
                        ${error.message}
                    </div>
                `);
            }

            // 3. ì‹¤ì œ ì •í™•í•œ ì¢Œí‘œ (Google Maps ê¸°ì¤€)
            results.push(`
                <h2>3ï¸âƒ£ ì°¸ê³ : Google Maps ì§ì ‘ ê²€ìƒ‰</h2>
                <div class="result">
                    <a class="map-link" href="https://www.google.com/maps/search/${encodeURIComponent(address)}" target="_blank">
                        ğŸ” Google Mapsì—ì„œ "${address}" ê²€ìƒ‰
                    </a>
                    <p><small>Google Mapsì—ì„œ ì§ì ‘ ê²€ìƒ‰í•œ ìœ„ì¹˜ì™€ ìœ„ API ê²°ê³¼ë¥¼ ë¹„êµí•˜ì„¸ìš”.</small></p>
                </div>
            `);

            resultsDiv.innerHTML = results.join('');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('ğŸš€ ìë™ í…ŒìŠ¤íŠ¸ ì‹œì‘');
                testAddress();
            }, 1000);
        });
    </script>
</body>
</html>
